import{g as e}from"./index-DNrAacen.js";import{g as r,a}from"./index-BaRU5fyc.js";import{c as s}from"./index-BW3hTftQ.js";import{f as l}from"./index-DUD_MFPX.js";import{r as i,e as d,dH as n,k as t,m as o,j as m,M as c,b as p,R as u,C as h,I as S,L as f,dI as w,dJ as C}from"./index-lfMN-dzl.js";import{S as g}from"./index-SeAE6s_k.js";import{R as y}from"./index-Bz7NLezF.js";import{T as I}from"./index-BYo8f2hE.js";import"./useShowArrow-hveFEwi9.js";import"./List-DCPKJ_Nj.js";import"./iconUtil-47jPM-3K.js";const b=i.forwardRef((({onConfirm:b},v)=>{const[x]=d.useForm(),[j,E]=i.useState(!1),[q,M]=i.useState({}),[U,A]=i.useState(new Map),[k,F]=i.useState(new Map),[N,_]=i.useState(new Map),[O,H]=i.useState(new Map),[R,T]=i.useState(),[D,L]=i.useState();i.useImperativeHandle(v,(()=>({showAddFormModal(){V(),E(!0)},async showEditFormModal(e){const{data:r,msg:a,code:s}=await n(e);s===t.SUCCESS?(M(r),x.setFieldsValue(r),T(r.dept),E(!0)):o.error(a)}}))),i.useEffect((()=>{(async()=>{const{data:i,msg:d,code:n}=await r("admin_sys_user_sex");if(n!==t.SUCCESS)return void o.error(d);A(a(i));const{data:m,msg:c,code:p}=await r("admin_sys_status");if(p!==t.SUCCESS)return void o.error(c);F(a(m));const{data:u,msg:h,code:S}=await s({});if(S!==t.SUCCESS)return void o.error(h);_(new Map(u.map((e=>[e.id,e.postName]))));const{data:f,msg:w,code:C}=await l({});if(C!==t.SUCCESS)return void o.error(w);H(new Map(f.map((e=>[e.id,e.roleName]))));const{data:g,msg:y,code:I}=await e({});I===t.SUCCESS?L(g):o.error(y)})()}),[]);const V=()=>{q.id>0?M({}):M({id:0}),setTimeout((()=>x.resetFields()),100)};return m(c,{title:q.id>0?"编辑":"新增",getContainer:!1,width:500,open:j,maskClosable:!1,keyboard:!1,onCancel:()=>{V(),E(!1)},destroyOnClose:!0,footer:[m(f,{onClick:e=>{V(),E(!1),e()},children:"取消"},"cancel"),m(f,{type:"primary",onClick:e=>(e=>{x.validateFields().then((async r=>{try{if(q.id<=0){const{msg:e,code:a}=await w(r);if(a!==t.SUCCESS)return void o.error(e);o.success(e)}else{const{msg:e,code:a}=await C(q.id,r);if(a!==t.SUCCESS)return void o.error(e);o.success(e)}}finally{e()}V(),E(!1),b()})).catch((r=>{o.error("表单校验失败"),e()}))})(e),children:"确定"},"confirm")],children:m(d,{form:x,layout:"vertical",initialValues:q,children:p(u,{gutter:24,children:[m(h,{span:12,children:m(d.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],children:m(S,{placeholder:"请输入用户名"})})}),m(h,{span:12,children:m(d.Item,{name:"nickName",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],children:m(S,{placeholder:"请输入昵称"})})}),m(h,{span:12,children:m(d.Item,{name:"sex",label:"性别",rules:[{required:!0,message:"请输入性别"}],children:m(g,{placeholder:"请选择",children:Array.from(U).map((([e,r])=>m(g.Option,{value:e,children:r},e)))})})}),q.id<=0&&m(h,{span:12,children:m(d.Item,{name:"password",label:"初始密码",rules:[{required:!0,message:"请输入初始密码"}],children:m(S,{placeholder:"请输入初始密码"})})}),m(h,{span:12,children:m(d.Item,{name:"phone",label:"手机号",rules:[{required:!0,message:"请输入手机号"}],children:m(S,{placeholder:"请输入手机号"})})}),m(h,{span:12,children:m(d.Item,{name:"email",label:"邮箱",rules:[{required:!0,message:"请输入邮箱"}],children:m(S,{placeholder:"请输入邮箱"})})}),m(h,{span:12,children:m(d.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请输入状态"}],children:m(y.Group,{children:Array.from(k).map((([e,r])=>m(y,{value:e,children:r},e)))})})}),m(h,{span:12,children:m(d.Item,{name:"deptId",label:"部门",rules:[{required:!0,message:"请选择部门"}],children:m(I,{showSearch:!0,style:{width:"100%"},value:R,treeNodeFilterProp:"deptName",fieldNames:{label:"deptName",value:"id",children:"children"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"请选择部门",allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{T(e)},treeData:D})})}),m(h,{span:12,children:m(d.Item,{name:"postId",label:"岗位",rules:[{required:!0,message:"请选择岗位"}],children:m(g,{placeholder:"请选择",children:Array.from(N).map((([e,r])=>m(g.Option,{value:e,children:r},e)))})})}),m(h,{span:12,children:m(d.Item,{name:"roleId",label:"角色",rules:[{required:!0,message:"请选择角色"}],children:m(g,{placeholder:"请选择",children:Array.from(O).map((([e,r])=>m(g.Option,{value:e,children:r},e)))})})}),m(h,{span:24,children:m(d.Item,{name:"remark",label:"备注",children:m(S.TextArea,{placeholder:"请输入备注"})})})]})})})}));export{b as default};

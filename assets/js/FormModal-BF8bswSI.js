import{a as e,g as r,b as a,u as l}from"./index-BZPT8p6m.js";import{r as t,e as i,k as s,m as o,j as d,M as n,b as c,R as m,C as h,I as p,L as u}from"./index-ISw6CgS3.js";import{T as f}from"./index-DGt0QDHR.js";import{T as S}from"./index-h1O26a0J.js";import"./useShowArrow-ZkZle5hu.js";import"./List-DXhAeaBF.js";import"./iconUtil-DIyXkSWd.js";const C=t.forwardRef((({onConfirm:C},g)=>{const[y]=i.useForm(),[b,v]=t.useState(!1),[I,j]=t.useState({}),[x,E]=t.useState(),[F,U]=t.useState();t.useImperativeHandle(g,(()=>({async showAddFormModal(){k();const{data:e,msg:a,code:l}=await r({});l===s.SUCCESS?(U(e),v(!0)):o.error(a)},async showEditFormModal(a){const{data:l,msg:t,code:i}=await e(a);if(i!==s.SUCCESS)return void o.error(t);const{data:d,msg:n,code:c}=await r({});if(c!==s.SUCCESS)return void o.error(n);const m=w(l,d);E(m),j(l),y.setFieldsValue(l),U(d),v(!0)}})));const k=()=>{I.id>0?j({}):j({id:0}),setTimeout((()=>y.resetFields()),100)};return d(n,{title:I.id>0?"编辑":"新增",getContainer:!1,width:500,open:b,maskClosable:!1,keyboard:!1,onCancel:()=>{k(),v(!1)},destroyOnClose:!0,footer:[d(u,{onClick:e=>{k(),v(!1),e()},children:"取消"},"cancel"),d(u,{type:"primary",onClick:e=>(e=>{y.validateFields().then((async r=>{try{if(I.id<=0){const{msg:e,code:l}=await a(r);if(l!==s.SUCCESS)return void o.error(e);o.success(e)}else{const{msg:e,code:a}=await l(I.id,r);if(a!==s.SUCCESS)return void o.error(e);o.success(e)}k(),v(!1),C()}finally{e()}})).catch((r=>{o.error("表单校验失败"),e()}))})(e),children:"确定"},"confirm")],children:c(i,{form:y,layout:"vertical",initialValues:I,children:[d(i.Item,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"选择上级部门"}],children:d(f,{showSearch:!0,style:{width:"100%"},value:x,treeNodeFilterProp:"deptName",fieldNames:{label:"deptName",value:"id",children:"children"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"选择上级部门",allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{E(e)},treeData:F})}),c(m,{gutter:24,children:[d(h,{span:12,children:d(i.Item,{name:"deptName",label:"部门名称",rules:[{required:!0,message:"请输入部门名称"}],children:d(p,{placeholder:"请输入部门名称"})})}),d(h,{span:12,children:d(i.Item,{name:"leader",label:"负责人",rules:[{required:!0,message:"请输入负责人"}],children:d(p,{placeholder:"请输入负责人"})})}),d(h,{span:12,children:d(i.Item,{name:"email",label:"邮箱",children:d(p,{placeholder:"请输入邮箱"})})}),d(h,{span:12,children:d(i.Item,{name:"phone",label:"电话",children:d(p,{placeholder:"请输入电话"})})}),d(h,{span:12,children:d(i.Item,{name:"sort",label:"排序",children:d(S,{placeholder:"请输入排序",style:{width:"100%"},min:0})})})]})]})})})),w=(e,r)=>{if(e)for(let a of r){if(e.parentId===a.id||e.id==a.id)return a;a.children&&w(e,a.children)}};export{C as default};

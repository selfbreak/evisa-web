import{g as e,a}from"./index-CL_tkCrR.js";import{D as r,r as l,e as i,k as n,m as s,j as d,M as o,b as t,F as p,R as m,C as c,I as u,dW as g,L as h}from"./index-CZh0p_oH.js";import{S as f}from"./index-BWNE0s_I.js";import{U as S}from"./index-6Treg_vs.js";const C=e=>r.get("/admin-api/v1/plugins/filemgr/filemgr-app",{...e,pageIndex:null==e?void 0:e.current}),y=e=>r.delete("/admin-api/v1/plugins/filemgr/filemgr-app",{ids:e}),v=e=>r.download("/admin-api/v1/plugins/filemgr/filemgr-app/export",e),{Dragger:w}=S,_=l.forwardRef((({onConfirm:S},C)=>{const[y]=i.useForm(),[v,_]=l.useState(!1),[b,I]=l.useState({}),[x,U]=l.useState(new Map),[E,F]=l.useState(new Map),[k,q]=l.useState(new Map),[A,M]=l.useState(new Map),[j,O]=l.useState(""),T={name:"file",multiple:!1,accept:".apk, .ipa",maxCount:1,onChange(e){const{status:a}=e.file;"done"===a?(y.setFieldValue("localAddress",e.file.response),s.success(`${e.file.name} 上传成功`)):"error"===a&&s.error(`${e.file.name} 上传失败`)},onDrop(e){}};l.useImperativeHandle(C,(()=>({showAddFormModal(){V(),_(!0)},async showEditFormModal(e){const{data:a,msg:l,code:i}=await(e=>r.get("/admin-api/v1/plugins/filemgr/filemgr-app/"+e))(e);i===n.SUCCESS?(I(a),y.setFieldsValue(a),_(!0)):s.error(l)}}))),l.useEffect((()=>{(async()=>{const{data:r,msg:l,code:i}=await e("plugin_filemgr_app_platform");if(i!==n.SUCCESS)return void s.error(l);U(a(r));const{data:d,msg:o,code:t}=await e("plugin_filemgr_app_type");if(t!==n.SUCCESS)return void s.error(o);F(a(d));const{data:p,msg:m,code:c}=await e("plugin_filemgr_app_download_type");if(c!==n.SUCCESS)return void s.error(m);q(a(p));const{data:u,msg:g,code:h}=await e("plugin_filemgr_publish_status");h===n.SUCCESS?M(a(u)):s.error(g)})()}),[]);const V=()=>{b.id>0?I({}):I({id:0}),O(""),setTimeout((()=>y.resetFields()),100)},D=e=>{y.validateFields().then((async a=>{try{if(b.id<=0){const{msg:e,code:i}=await(l=a,r.post("/admin-api/v1/plugins/filemgr/filemgr-app",l));if(i!==n.SUCCESS)return void s.error(e);s.success(e)}else{const{msg:e,code:l}=await((e,a)=>r.put("/admin-api/v1/plugins/filemgr/filemgr-app/"+e,a))(b.id,a);if(l!==n.SUCCESS)return void s.error(e);s.success(e)}V(),_(!1),S()}finally{e()}var l})).catch((a=>{s.error("表单校验失败"),e()}))};return d(o,{title:b.id>0?"编辑":"新增",getContainer:!1,width:500,open:v,maskClosable:!1,keyboard:!1,onCancel:()=>{V(),_(!1)},destroyOnClose:!0,footer:[d(h,{onClick:e=>{V(),_(!1),e()},children:"取消"},"cancel"),d(h,{type:"primary",onClick:e=>D(e),children:"确定"},"confirm")],children:t(i,{form:y,layout:"vertical",onValuesChange:(e,a)=>{O(a.downloadType)},initialValues:b,children:[b.id<=0&&t(p,{children:[t(m,{gutter:24,children:[d(c,{span:12,children:d(i.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"}],children:d(u,{placeholder:"请输入版本号"})})}),d(c,{span:12,children:d(i.Item,{name:"platform",label:"系统平台",rules:[{required:!0,message:"请输入系统平台"}],children:d(f,{placeholder:"请选择",children:Array.from(x).map((([e,a])=>d(f.Option,{value:e,children:a},e)))})})}),d(c,{span:12,children:d(i.Item,{name:"downloadType",label:"下载方式",rules:[{required:!0,message:"请输入下载方式"}],children:d(f,{placeholder:"请选择",children:Array.from(k).map((([e,a])=>d(f.Option,{value:e,children:a},e)))})})}),d(c,{span:12,children:d(i.Item,{name:"appType",label:"版本类型",rules:[{required:!0,message:"请输入版本类型"}],children:d(f,{placeholder:"请选择",children:Array.from(E).map((([e,a])=>d(f.Option,{value:e,children:a},e)))})})})]}),"2"===j&&d(i.Item,{name:"downloadUrl",label:"下载地址",rules:[{required:!0,message:"请输入下载地址"}],children:d(u,{placeholder:"请输入下载地址"})}),"1"===j&&d(p,{children:d(i.Item,{name:"localRootUrl",label:"本地根地址",rules:[{required:!0,message:"请输入本地根地址"}],children:d(u,{placeholder:"请输入本地根地址"})})}),("1"===j||"3"===j)&&t(p,{children:[t(w,{...T,children:[d("p",{className:"ant-upload-drag-icon",children:d(g,{})}),t("p",{className:"ant-upload-text",children:["将文件拖到此处，或",d("em",{children:"点击上传"})]}),d("p",{className:"ant-upload-hint",children:"提示：仅允许导入“apk”或“ipa”格式文件！"})]}),d(i.Item,{name:"localAddress",style:{display:"none"},children:d(u,{})})]}),d(i.Item,{name:"remark",label:"更新内容",rules:[{required:!0,message:"请输入更新内容"}],children:d(u.TextArea,{placeholder:"请输入更新内容"})})]}),b.id>0&&d(i.Item,{name:"status",label:"发布状态",rules:[{required:!0,message:"请输入发布状态"}],children:d(f,{placeholder:"请选择",children:Array.from(A).map((([e,a])=>d(f.Option,{value:e,children:a},e)))})})]})})})),b=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"}));export{_ as F,b as a,y as d,v as e,C as g};

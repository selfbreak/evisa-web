import{a as e,g as r,b as a,u as s}from"./index-BSArCK1r.js";import{r as t,e as i,k as l,m as o,j as d,M as n,b as c,R as m,C as h,I as p,L as u}from"./index-Dn3i6gWy.js";import{T as f}from"./index--VoPcJhY.js";import{T as S}from"./index-2Ycx2kMs.js";import"./useShowArrow-M8oUPwlT.js";import"./List-C3VBTCeL.js";import"./useIcons-BRiVyyhT.js";import"./iconUtil-B8G77sRB.js";const C=t.forwardRef((({onConfirm:C},g)=>{const[y]=i.useForm(),[b,I]=t.useState(!1),[j,v]=t.useState({}),[x,E]=t.useState(),[F,U]=t.useState();t.useImperativeHandle(g,(()=>({async showAddFormModal(){k();const{data:e,msg:a,code:s}=await r({});s===l.SUCCESS?(U(e),I(!0)):o.error(a)},async showEditFormModal(a){const{data:s,msg:t,code:i}=await e(a);if(i!==l.SUCCESS)return void o.error(t);const{data:d,msg:n,code:c}=await r({});if(c!==l.SUCCESS)return void o.error(n);const m=w(s,d);E(m),v(s),y.setFieldsValue(s),U(d),I(!0)}})));const k=()=>{j.id>0?v({}):v({id:0}),setTimeout((()=>y.resetFields()),100)};return d(n,{title:j.id>0?"编辑":"新增",getContainer:!1,width:500,open:b,maskClosable:!1,keyboard:!1,onCancel:()=>{k(),I(!1)},destroyOnClose:!0,footer:[d(u,{onClick:e=>{k(),I(!1),e()},children:"取消"},"cancel"),d(u,{type:"primary",onClick:e=>(e=>{y.validateFields().then((async r=>{try{if(j.id<=0){const{msg:e,code:s}=await a(r);if(s!==l.SUCCESS)return void o.error(e);o.success(e)}else{const{msg:e,code:a}=await s(j.id,r);if(a!==l.SUCCESS)return void o.error(e);o.success(e)}k(),I(!1),C()}finally{e()}})).catch((r=>{o.error("表单校验失败"),e()}))})(e),children:"确定"},"confirm")],children:c(i,{form:y,layout:"vertical",initialValues:j,children:[d(i.Item,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"选择上级部门"}],children:d(f,{showSearch:!0,style:{width:"100%"},value:x,treeNodeFilterProp:"deptName",fieldNames:{label:"deptName",value:"id",children:"children"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"选择上级部门",allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{E(e)},treeData:F})}),c(m,{gutter:24,children:[d(h,{span:12,children:d(i.Item,{name:"deptName",label:"部门名称",rules:[{required:!0,message:"请输入部门名称"}],children:d(p,{placeholder:"请输入部门名称"})})}),d(h,{span:12,children:d(i.Item,{name:"leader",label:"负责人",rules:[{required:!0,message:"请输入负责人"}],children:d(p,{placeholder:"请输入负责人"})})}),d(h,{span:12,children:d(i.Item,{name:"email",label:"邮箱",children:d(p,{placeholder:"请输入邮箱"})})}),d(h,{span:12,children:d(i.Item,{name:"phone",label:"电话",children:d(p,{placeholder:"请输入电话"})})}),d(h,{span:12,children:d(i.Item,{name:"sort",label:"排序",children:d(S,{placeholder:"请输入排序",style:{width:"100%"},min:0})})})]})]})})})),w=(e,r)=>{if(e)for(let a of r){if(e.parentId===a.id||e.id==a.id)return a;a.children&&w(e,a.children)}};export{C as default};

import{g as e}from"./index-8L4V_yxL.js";import{g as t,a as i}from"./index-Cc57wi3Z.js";import{p as r,r as n,b as a,F as d,j as s,dF as l,dK as o,L as c,dL as m,dM as p,k as u,m as h,z as f,S as x,v as j,w as g,dN as y,x as w,dO as S,y as v}from"./index-CiAhniVm.js";import{H as C}from"./index-CekffMGP.js";import{L as I}from"./index-C9ujnCkB.js";import{p as k}from"./proTable-BUOzHjgg.js";import{f as T}from"./index-Ciy2PQr0.js";import b from"./ChangePwdFormModal-BF1WtDy_.js";import E from"./FormModal-BkqOCwJv.js";import{T as N}from"./index-Cv3fXZDU.js";import{P as F}from"./Table-D4zPh61m.js";import"./index-DjgaDbYj.js";import"./index-CsmvDA_R.js";import"./index-BJu6fcxc.js";import"./useShowArrow-DWmC_yFD.js";import"./List-DhKJSDjz.js";import"./useIcons-6XAMJw6F.js";import"./index-Bunx-TGd.js";import"./index-BZGZglRs.js";import"./iconUtil--IrZyQfQ.js";import"./ProCard-DhCsLkVC.js";import"./useMultipleSelect-DecdAo2-.js";import"./dayjs.min-x_ORfqZN.js";import"./index-C2YQhxTC.js";import"./Table-D6v_rokp.js";import"./addEventListener-DLPOesXj.js";import"./index-76LpRGMh.js";import"./progress-i1-phs3_.js";import"./index-CTQNLHnJ.js";import"./index-BHOlpetE.js";import"./index-CgyDKZIA.js";import"./index-D_cDM7fs.js";import"./index-DYoDAZSL.js";const M=()=>{const M=r.useRef(),R=r.useRef(),z=n.useRef(null),L=n.useRef(null),[P,U]=n.useState(new Map),[A,K]=n.useState(),[_,B]=n.useState(0),D=[{title:"序号",dataIndex:"index",valueType:"index",width:50,align:"center",className:"gray-cell",render:(e,t,i,r)=>{var n,a;return(((null==(n=null==r?void 0:r.pageInfo)?void 0:n.current)||1)-1)*((null==(a=null==r?void 0:r.pageInfo)?void 0:a.pageSize)||10)+i+1}},{title:"用户",dataIndex:"id",hideInSearch:!0,width:50,align:"left"},{title:"用户名",dataIndex:"username",width:80,align:"left"},{title:"角色",dataIndex:"roleId",hideInSearch:!0,width:100,render:(e,t)=>{var i;return null==(i=t.role)?void 0:i.roleName},align:"left"},{title:"部门",dataIndex:"deptId",hideInSearch:!0,render:(e,t)=>{var i;return null==(i=t.dept)?void 0:i.deptName},width:100,align:"left"},{title:"岗位",dataIndex:"postId",hideInSearch:!0,render:(e,t)=>{var i;return null==(i=t.post)?void 0:i.postName},width:120,align:"left"},{title:"手机号",dataIndex:"phone",width:120,align:"left"},{title:"邮箱",dataIndex:"email",hideInSearch:!0,width:180,align:"left"},{title:"状态",dataIndex:"status",valueType:"select",valueEnum:P,width:80,align:"left",render:(e,t,i,r)=>s(d,{children:"admin"!==t.username&&s(I,{checked:"1"===t.status,checkedChildren:"开启",unCheckedChildren:"关闭",onChange:e=>q(e,t,r)})})},{title:"创建时间",dataIndex:"createdAt",hideInSearch:!0,valueType:"dateTime",width:180,align:"left"},{title:"操作",valueType:"option",align:"center",fixed:"right",width:250,render:(e,t)=>a(x,{children:[s(C,{permission:["admin:sys-user:edit"],children:s(c,{type:"link",size:"small",icon:s(j,{}),onClick:e=>H(t.id,e),children:"编辑"},"edit")}),s(C,{permission:["admin:sys-user:edit-pwd"],children:s(c,{type:"link",size:"small",icon:s(j,{}),onClick:e=>O(t.id,e),children:"修改密码"},"changePwd")}),"admin"!==t.username&&s(C,{permission:["admin:sys-user:del"],children:s(c,{type:"link",size:"small",danger:!0,icon:s(g,{}),onClick:e=>W(t.id,e),children:"删除"},"delete")})]})}];n.useEffect((()=>{(async()=>{const{data:r,msg:n,code:a}=await t("admin_sys_status");if(a!==u.SUCCESS)return void h.error(n);U(i(r));const{data:d,msg:s,code:l}=await e({});l===u.SUCCESS?(K(d),B("")):h.error(s)})()}),[]);const H=(e,t)=>{var i;null==(i=z.current)||i.showEditFormModal(e),setTimeout((()=>t()),1e3)},O=(e,t)=>{var i;null==(i=L.current)||i.showChangePwdFormModal(e),setTimeout((()=>t()),1e3)},q=async(e,t,i)=>{const r=e?"1":"2",{code:n,msg:a}=await y(t.id,r);n===u.SUCCESS?i.reload():h.error(a)};n.useEffect((()=>{M.current&&M.current.reload()}),[_]);const W=(e,t)=>{w.confirm({title:"提示",icon:s(v,{}),content:"是否确认删除编号为 "+e+" 的数据项?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{t()},onOk:async()=>{var i;try{const{code:t,msg:r}=await S([e]);if(t!==u.SUCCESS)return void h.error(r);null==(i=M.current)||i.reload(!1),h.success(r)}finally{t()}}})};return a(d,{children:[a(l,{children:[s(o,{style:{paddingTop:20},children:A&&a(d,{children:[s(c,{type:"link",onClick:e=>{B(""),e()},children:"清空选中"}),s(N,{defaultExpandAll:!0,fieldNames:{title:"deptName",key:"id",children:"children"},treeData:A,selectedKeys:[_],onSelect:e=>{e.length>0&&B(e[0])}})]})}),s(l,{children:s(m,{style:{padding:0,margin:0,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s(F,{className:"ant-pro-table-scroll",columns:D,actionRef:M,formRef:R,bordered:!0,cardBordered:!0,defaultSize:"small",scroll:{x:"100%",y:"100%"},request:async e=>{let t={...e,deptId:_};const{data:i}=await p(t);return T(i)},columnsState:{persistenceKey:"use-pro-table-key",persistenceType:"localStorage"},options:{reload:!0,density:!0,fullScreen:!0},rowKey:"id",search:{labelWidth:"auto",showHiddenNum:!0},pagination:k,dateFormatter:"string",headerTitle:"用户管理",toolBarRender:()=>[s(C,{permission:["admin:sys-user:add"],children:s(c,{type:"primary",icon:s(f,{}),onClick:e=>(e=>{var t;null==(t=z.current)||t.showAddFormModal(),setTimeout((()=>e()),1e3)})(e),children:"新增"},"addTable")})]})})})]}),s(E,{ref:z,onConfirm:()=>{var e;null==(e=M.current)||e.reload(!1)}}),s(b,{ref:L,onConfirm:()=>{var e;null==(e=M.current)||e.reload(!1)}})]})};export{M as default};

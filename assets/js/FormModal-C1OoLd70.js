import{D as e,r as t,e as a,k as n,m as i,j as l,F as s,b as r,I as d,R as o,C as A,G as c,co as h,B as g,S as m,L as E}from"./index-lfMN-dzl.js";import{g as Q,e as u,a as y,b as p,c as B,d as C,f as I,h as f}from"./index-Dt5vOpom.js";import{D as S}from"./index-CoIKVHZd.js";import{D as v}from"./index-uQQ3CxzE.js";import{U as b}from"./index-aqOA4_Yl.js";import{R as w}from"./index-Bz7NLezF.js";import{S as J}from"./index-SeAE6s_k.js";import{D as j,I as N}from"./index-CSzNbfux.js";import"./progress-BWYi3WI8.js";import"./useShowArrow-hveFEwi9.js";import"./List-DCPKJ_Nj.js";import"./addEventListener-Do7UNsrD.js";const k=t.forwardRef((({onConfirm:k},Y)=>{const[K]=a.useForm(),[R,x]=t.useState(!1),[F,U]=t.useState({}),[z,D]=t.useState("single"),[M,T]=t.useState(!1),[H,L]=t.useState(""),[G,P]=t.useState(""),[Z,q]=t.useState(""),[V,X]=t.useState(""),[O,W]=t.useState(""),[_,$]=t.useState(""),[ee,te]=t.useState(""),[ae,ne]=t.useState("");t.useImperativeHandle(Y,(()=>({showAddFormModal(){ie(),x(!0)},async showEditFormModal(e){const{data:t,msg:a,code:l}=await Q(e);l===n.SUCCESS?(U(t),K.setFieldsValue(t),P(`${t.first_name} ${t.last_name}`),q(t.passport_number||""),x(!0)):i.error(a)}})));const ie=()=>{F.id>0?U({}):U({id:0}),setTimeout((()=>K.resetFields()),100)},le=t=>{K.validateFields().then((async a=>{var l,s,r;try{const t={...a,entry_date:null==(l=a.entry_date)?void 0:l.format("DD/MM/YYYY"),exit_date:null==(s=a.exit_date)?void 0:s.format("DD/MM/YYYY")};if(F.id<=0){const{msg:a,code:l}=await(r=t,e.post("/admin-api/v1/app/user/user",r));if(l!==n.SUCCESS)return void i.error(a);i.success(a)}else{const{msg:e,code:a}=await f(F.id,t);if(a!==n.SUCCESS)return void i.error(e);i.success("提交成功，请到列表点击支付按钮")}ie(),x(!1),k()}finally{t()}})).catch((e=>{i.error("表单校验失败"),t()}))};return l(s,{children:r(S,{title:F.id>0?"apply":"新增用户",width:1200,open:R,onClose:()=>{ie(),x(!1)},bodyStyle:{padding:"10px"},footerStyle:{textAlign:"right"},footer:r(m,{children:[l(E,{onClick:e=>{ie(),x(!1),e()},children:"取消"}),l(E,{type:"primary",onClick:e=>le(e),children:"确定"})]}),children:[F.id<=0&&r(a,{form:K,layout:"vertical",initialValues:F,children:[l(a.Item,{name:"mobileTitle",label:"国家区号",children:l(d,{placeholder:"请输入国家区号"})}),l(a.Item,{name:"mobiles",label:"手机号码集合",children:l(d.TextArea,{placeholder:"请输入手机号(多个手机号之间使用半角逗号分割)"})}),l(a.Item,{name:"emails",label:"邮箱集合",children:l(d.TextArea,{placeholder:"请输入邮箱(多个邮箱之间使用半角逗号分割)"})}),l(a.Item,{name:"refCode",label:"邀请码",children:l(d,{placeholder:"请输入邀请码"})})]}),F.id>0&&l(a,{form:K,layout:"vertical",initialValues:F,autoComplete:"off",children:r(o,{children:[r(A,{span:12,children:[l(v,{children:"用户信息"}),r(o,{gutter:16,children:[l(A,{span:12,children:r(o,{gutter:14,children:[l(A,{span:4,children:"姓名"}),l(A,{span:10,children:G})]})}),l(A,{span:12,children:r(o,{gutter:12,children:[l(A,{span:5,children:"护照号"}),l(A,{span:8,children:Z})]})})]}),l(v,{children:"基本信息"}),r(o,{gutter:16,children:[r(A,{span:12,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"邮箱地址"}),l(c,{title:"刷新邮箱地址",children:l(h,{onClick:async()=>{const e=await(async()=>await p())();200===e.code?(X(e.data.email||""),K.setFieldsValue({email:e.data.email}),i.success("邮箱已更新")):i.error("刷新邮箱失败")},style:{cursor:"pointer",fontSize:16}})})]}),l(a.Item,{name:"email",style:{marginBottom:16},children:l(d,{placeholder:"请输入邮箱地址",value:V,onChange:e=>X(e.target.value)})})]}),r(A,{span:12,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"手机号码"}),l(c,{title:"刷新手机号码",children:l(h,{onClick:async()=>{const e=await(async()=>await B())();200===e.code?(W(e.data),K.setFieldsValue({mobile:e.data}),i.success("邮箱已更新")):i.error("刷新邮箱失败")},style:{cursor:"pointer",fontSize:16}})})]}),l(a.Item,{name:"mobile",style:{marginBottom:16},children:l(d,{placeholder:"请输入手机号码"})})]})]}),r(o,{gutter:[16,16],children:[r(A,{span:24,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"中国地址"}),l(c,{title:"Refresh China Address",children:l(h,{onClick:async()=>{const e=await(async()=>await C())();200===e.code?($(e.data),K.setFieldsValue({china_address:e.data}),i.success("The address has been updated.")):i.error("Failed to refresh the address.")},style:{cursor:"pointer",fontSize:16}})})]}),l(a.Item,{name:"china_address",style:{marginBottom:16},children:l(d.TextArea,{placeholder:"请输入中国地址",value:O,onChange:e=>W(e.target.value),autoSize:{minRows:2}})})]}),r(A,{span:24,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"吉尔吉斯地址"}),l(c,{title:"Refresh Kyrgyz Address",children:l(h,{onClick:async()=>{const e=await(async()=>await I())();200===e.code?(te(e.data),K.setFieldsValue({kg_address:e.data}),i.success("The address has been updated.")):i.error("Failed to refresh the address.")},style:{cursor:"pointer",fontSize:16}})})]}),l(a.Item,{name:"kg_address",children:l(d.TextArea,{placeholder:"请输入吉尔吉斯地址",value:ee,onChange:e=>te(e.target.value),autoSize:{minRows:2}})})]})]}),l(v,{children:"上传2寸照片信息"}),r(a.Item,{name:"photo",children:[l(d,{type:"hidden"}),l(b,{name:"file",listType:"picture-card",showUploadList:!1,customRequest:async({file:e,onSuccess:t,onError:a})=>{T(!0);try{const n=e;await u({file:n,onSuccess:e=>{400===e.code?(i.error(`${n.name} 上传失败: ${e.msg}`),null==a||a(new Error(e.msg))):(i.success(`${n.name} 上传成功`),K.setFieldsValue({photo:e.data}),ne("http://localhost:8011/"+e.data),null==t||t("ok"))},onError:e=>{i.error(`${n.name} 上传失败: ${e.message}`),null==a||a(e)}})}catch(n){i.error("上传过程发生异常"),null==a||a(n)}finally{T(!1)}},children:ae?r("div",{style:{textAlign:"center"},children:[l("div",{style:{width:"100%",paddingTop:"100%",position:"relative",overflow:"hidden"},children:l("img",{src:ae,alt:"uploaded",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",cursor:"pointer"},onClick:()=>window.open(ae,"_blank")})}),l("div",{style:{marginTop:8,textAlign:"center",color:"#1677ff"},children:l("span",{children:"重新上传"})})]}):l("div",{style:{textAlign:"center",color:"#999",background:"none"},children:"点击上传"})})]})]}),r(A,{span:12,style:{paddingLeft:20},children:[l(v,{children:"签证信息"}),r(o,{gutter:16,children:[r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"服务级别"})}),l(a.Item,{name:"service_level",children:r(w.Group,{children:[l(w.Button,{value:"normal",children:"普通"}),l(w.Button,{value:"urgent",children:"加急"})]})})]}),r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"签证次数"})}),l(a.Item,{name:"entry_type",children:r(w.Group,{onChange:e=>{D(e.target.value),K.setFieldsValue({visa_type:"«Один месяц»"})},children:[l(w.Button,{value:"single",children:"单次"}),l(w.Button,{value:"multiple",children:"多次"})]})})]}),r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"签证类型"})}),l(a.Item,"single"===z?{name:"visa_type",children:r(J,{defaultValue:"«Один месяц»",children:[l(J.Option,{value:"«Один месяц»",children:"单次1个月"}),l(J.Option,{value:"«Два месяца»",children:"单次2个月"}),l(J.Option,{value:"«Три месяца»",children:"单次3个月"})]})}:{name:"visa_type",children:r(J,{defaultValue:"«Один месяц»",children:[l(J.Option,{value:"«Один месяц»",children:"多次1个月"}),l(J.Option,{value:"«Два месяца»",children:"多次2个月"}),l(J.Option,{value:"«Три месяца»",children:"多次3个月"})]})})]})]}),r(o,{gutter:16,children:[r(A,{span:12,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"入境日期"})}),l(a.Item,{name:"entry_date",children:l(j,{format:"DD/MM/YYYY"})})]}),r(A,{span:12,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"出境日期"})}),l(a.Item,{name:"exit_date",children:l(j,{format:"DD/MM/YYYY"})})]})]}),l(v,{children:"生成签名照信息"}),l(a.Item,{name:"sign_image",children:l(d,{type:"hidden"})}),l(N,{width:200,height:200,src:H,fallback:"data:image/png;base64,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"}),l("div",{style:{marginTop:"10px"},children:l(g,{type:"primary",onClick:async()=>{const e=await y(F.id??0,{address:K.getFieldsValue().china_address,phone:K.getFieldsValue().mobile,duration:K.getFieldsValue().visa_type});200===e.code?(L(e.data),K.setFieldsValue({sign_image:e.data}),i.success("生成成功")):i.error("生成失败")},children:H.length>0?"重新生成签名照":"生成签名照片"})})]})]})})]})})}));export{k as default};

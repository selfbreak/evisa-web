import{g as e}from"./index-ksGEXXk2.js";import{g as t,a as i}from"./index-CL_tkCrR.js";import{p as r,r as n,b as a,F as d,j as l,dF as s,dK as o,L as c,dL as m,dM as p,k as u,m as h,z as f,S as x,v as g,w as y,dN as j,x as w,dO as S,y as v}from"./index-CZh0p_oH.js";import{H as C}from"./index-Bw2Vx1Ut.js";import{L as I}from"./index-BBwCgbV4.js";import{p as k}from"./proTable-BUOzHjgg.js";import{f as T}from"./index-Ciy2PQr0.js";import b from"./ChangePwdFormModal-Cy3ZF2-r.js";import E from"./FormModal-BCrBwkoi.js";import{T as N}from"./index-CqN5Ooqi.js";import{P as F}from"./Table-CKIF0KuE.js";import"./index-Cws43ofp.js";import"./index-BsCx_xpK.js";import"./index-BWNE0s_I.js";import"./useShowArrow-CUxPklP2.js";import"./List-DqGO3k9Q.js";import"./index-DQ26OUIh.js";import"./index-DAFMvJY8.js";import"./iconUtil-DYt6AuPS.js";import"./ProCard-YIQO1D1F.js";import"./useMultipleSelect-gcGQZKVm.js";import"./index-DW8FjFu4.js";import"./index-BZLopOkK.js";import"./Table-DWGBDBqS.js";import"./addEventListener-sA_wUh1h.js";import"./progress-DeWSa0eq.js";import"./index-B8N73VGL.js";import"./index--TOMb3kV.js";import"./index-cT5F2lma.js";import"./index-Bp6WHyE5.js";const M=()=>{const M=r.useRef(),R=r.useRef(),z=n.useRef(null),L=n.useRef(null),[P,U]=n.useState(new Map),[A,K]=n.useState(),[B,D]=n.useState(0),H=[{title:"序号",dataIndex:"index",valueType:"index",width:50,align:"center",className:"gray-cell",render:(e,t,i,r)=>{var n,a;return(((null==(n=null==r?void 0:r.pageInfo)?void 0:n.current)||1)-1)*((null==(a=null==r?void 0:r.pageInfo)?void 0:a.pageSize)||10)+i+1}},{title:"用户",dataIndex:"id",hideInSearch:!0,width:50,align:"left"},{title:"用户名",dataIndex:"username",width:80,align:"left"},{title:"角色",dataIndex:"roleId",hideInSearch:!0,width:100,render:(e,t)=>{var i;return null==(i=t.role)?void 0:i.roleName},align:"left"},{title:"部门",dataIndex:"deptId",hideInSearch:!0,render:(e,t)=>{var i;return null==(i=t.dept)?void 0:i.deptName},width:100,align:"left"},{title:"岗位",dataIndex:"postId",hideInSearch:!0,render:(e,t)=>{var i;return null==(i=t.post)?void 0:i.postName},width:120,align:"left"},{title:"手机号",dataIndex:"phone",width:120,align:"left"},{title:"邮箱",dataIndex:"email",hideInSearch:!0,width:180,align:"left"},{title:"状态",dataIndex:"status",valueType:"select",valueEnum:P,width:80,align:"left",render:(e,t,i,r)=>l(d,{children:"admin"!==t.username&&l(I,{checked:"1"===t.status,checkedChildren:"开启",unCheckedChildren:"关闭",onChange:e=>_(e,t,r)})})},{title:"创建时间",dataIndex:"createdAt",hideInSearch:!0,valueType:"dateTime",width:180,align:"left"},{title:"操作",valueType:"option",align:"center",fixed:"right",width:250,render:(e,t)=>a(x,{children:[l(C,{permission:["admin:sys-user:edit"],children:l(c,{type:"link",size:"small",icon:l(g,{}),onClick:e=>O(t.id,e),children:"编辑"},"edit")}),l(C,{permission:["admin:sys-user:edit-pwd"],children:l(c,{type:"link",size:"small",icon:l(g,{}),onClick:e=>W(t.id,e),children:"修改密码"},"changePwd")}),"admin"!==t.username&&l(C,{permission:["admin:sys-user:del"],children:l(c,{type:"link",size:"small",danger:!0,icon:l(y,{}),onClick:e=>q(t.id,e),children:"删除"},"delete")})]})}];n.useEffect((()=>{(async()=>{const{data:r,msg:n,code:a}=await t("admin_sys_status");if(a!==u.SUCCESS)return void h.error(n);U(i(r));const{data:d,msg:l,code:s}=await e({});s===u.SUCCESS?(K(d),D("")):h.error(l)})()}),[]);const O=(e,t)=>{var i;null==(i=z.current)||i.showEditFormModal(e),setTimeout((()=>t()),1e3)},W=(e,t)=>{var i;null==(i=L.current)||i.showChangePwdFormModal(e),setTimeout((()=>t()),1e3)},_=async(e,t,i)=>{const r=e?"1":"2",{code:n,msg:a}=await j(t.id,r);n===u.SUCCESS?i.reload():h.error(a)};n.useEffect((()=>{M.current&&M.current.reload()}),[B]);const q=(e,t)=>{w.confirm({title:"提示",icon:l(v,{}),content:"是否确认删除编号为 "+e+" 的数据项?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{t()},onOk:async()=>{var i;try{const{code:t,msg:r}=await S([e]);if(t!==u.SUCCESS)return void h.error(r);null==(i=M.current)||i.reload(!1),h.success(r)}finally{t()}}})};return a(d,{children:[a(s,{children:[l(o,{style:{paddingTop:20},children:A&&a(d,{children:[l(c,{type:"link",onClick:e=>{D(""),e()},children:"清空选中"}),l(N,{defaultExpandAll:!0,fieldNames:{title:"deptName",key:"id",children:"children"},treeData:A,selectedKeys:[B],onSelect:e=>{e.length>0&&D(e[0])}})]})}),l(s,{children:l(m,{style:{padding:0,margin:0,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:l(F,{className:"ant-pro-table-scroll",columns:H,actionRef:M,formRef:R,bordered:!0,cardBordered:!0,defaultSize:"small",scroll:{x:"100%",y:"100%"},request:async e=>{let t={...e,deptId:B};const{data:i}=await p(t);return T(i)},columnsState:{persistenceKey:"use-pro-table-key",persistenceType:"localStorage"},options:{reload:!0,density:!0,fullScreen:!0},rowKey:"id",search:{labelWidth:"auto",showHiddenNum:!0},pagination:k,dateFormatter:"string",headerTitle:"用户管理",toolBarRender:()=>[l(C,{permission:["admin:sys-user:add"],children:l(c,{type:"primary",icon:l(f,{}),onClick:e=>(e=>{var t;null==(t=z.current)||t.showAddFormModal(),setTimeout((()=>e()),1e3)})(e),children:"新增"},"addTable")})]})})})]}),l(E,{ref:z,onConfirm:()=>{var e;null==(e=M.current)||e.reload(!1)}}),l(b,{ref:L,onConfirm:()=>{var e;null==(e=M.current)||e.reload(!1)}})]})};export{M as default};

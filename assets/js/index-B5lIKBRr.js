import{a as e,i,b as n,d as a,c as t,e as r}from"./index-Crjf4f7M.js";import{H as s}from"./index-TY7Hxc2-.js";import{u as o,r as l,E as d,b as c,F as m,j as p,L as u,ay as y,S as h,v as f,az as x,w as C,k,m as g,aA as j,x as w,y as T}from"./index-DsQ3zqfA.js";import{p as S}from"./proTable-BUOzHjgg.js";import{f as b,b as v}from"./index-Ciy2PQr0.js";import I from"./DBTableModal-CTy8OmVr.js";import z from"./PreviewCodeModal-4erIEn4V.js";import{P as A}from"./Table-Dy-QAJ1j.js";import"./ProCard-B9s2hTgZ.js";import"./useMultipleSelect-pfk93rGl.js";import"./index-DdT6fX1-.js";import"./iconUtil-C-q1LhdA.js";import"./List-Bxj27K06.js";import"./index-DzAJL26A.js";import"./useShowArrow-Bex1hh_V.js";import"./index-DujKG-hl.js";import"./index-DvtJArEh.js";import"./index-DfY_9hq-.js";import"./Table-Ck376EZf.js";import"./addEventListener-_XWjYs0H.js";import"./index-DkQxkdFP.js";import"./progress-sJM18Av7.js";import"./index-CmghjKUz.js";import"./index-BgcirBuW.js";import"./index-CU_DloQn.js";import"./index-CF_hTOCN.js";const E=()=>{const E=o(),M=l.useRef(null),R=l.useRef(),N=l.useRef(null),{drop:U}=d.useAliveController(),B=[{title:"序号",dataIndex:"index",valueType:"index",width:80,align:"center",className:"gray-cell",render:(e,i,n,a)=>{var t,r;return(((null==(t=null==a?void 0:a.pageInfo)?void 0:t.current)||1)-1)*((null==(r=null==a?void 0:a.pageInfo)?void 0:r.pageSize)||10)+n+1}},{title:"表编号",dataIndex:"id",width:80,hideInSearch:!0},{title:"数据库表名",dataIndex:"tableName",width:300},{title:"数据库表描述",dataIndex:"tableComment",width:150},{title:"类名",dataIndex:"className",hideInSearch:!0,width:180},{title:"创建时间",key:"createdAt",dataIndex:"createdAt",valueType:"dateTime",hideInSearch:!0,width:180},{title:"创建时间",dataIndex:"createTime",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({beginCreatedAt:e[0],endCreatedAt:e[1]})}},{title:"操作",key:"option",fixed:"right",width:530,hideInSearch:!0,render:(e,i)=>c(h,{children:[p(s,{permission:["admin:sys-gen:edit"],children:p(u,{type:"link",size:"small",icon:p(f,{}),onClick:e=>{O(i.id,e)},children:"编辑"},"edit")}),p(s,{permission:["admin:sys-gen:preview"],children:p(u,{type:"link",size:"small",icon:p(x,{}),onClick:e=>{P(i.id,e)},children:"预览"},"preview")}),p(s,{permission:["admin:sys-gen:gen-code"],children:p(u,{type:"link",size:"small",icon:p(x,{}),onClick:e=>{L(i.id,e)},children:"生成代码"},"genCode")}),p(s,{permission:["admin:sys-gen:download-code"],children:p(u,{type:"link",size:"small",icon:p(x,{}),onClick:e=>{D(i.id,e)},children:"下载代码"},"downCode")}),p(s,{permission:["admin:sys-gen:import-config"],children:p(u,{type:"link",size:"small",icon:p(x,{}),onClick:e=>{q(i.id,e)},children:"配置导入"},"genMenu")}),p(s,{permission:["admin:sys-gen:del"],children:p(u,{type:"link",size:"small",danger:!0,icon:p(C,{}),onClick:e=>F(i.id,e),children:"删除"},"del")})]})}],O=async(e,i)=>{await U(j),E(j,{state:{id:e}}),setTimeout((()=>i()),1e3)},P=async(e,i)=>{var n;null==(n=N.current)||n.showPreviewCodeModal(e),setTimeout((()=>i()),1e3)},L=async(e,i)=>{w.confirm({title:"提示",icon:p(T,{}),content:"是否为编号 "+e+" 生成代码?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{i()},onOk:async()=>{try{const{msg:i,code:a}=await n(e);if(a!==k.SUCCESS)return void g.error(i);g.success(i)}finally{i()}}})},q=async(e,i)=>{w.confirm({title:"提示",icon:p(T,{}),content:"导入完成后，需要重新手动刷新页面。是否为编号 "+e+" 导入菜单到数据库?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{i()},onOk:async()=>{try{const{msg:i,code:n}=await t(e);if(n!==k.SUCCESS)return void g.error(i);g.success(i)}finally{i()}}})},D=async(e,i)=>{w.confirm({title:"提示",icon:p(T,{}),content:"是否确认下载编号为 "+e+" 的代码?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{i()},onOk:async()=>{try{v("code",await a(e))}catch(n){g.error("下载失败，请检查网络")}finally{i()}}})},F=(e,i)=>{w.confirm({title:"提示",icon:p(T,{}),content:"是否确认删除编号为 "+e+" 的数据项?",okText:"确认",cancelText:"取消",maskClosable:!0,onCancel:()=>{i()},onOk:async()=>{var i;try{const{code:n,msg:a}=await r([e]);if(n!==k.SUCCESS)return void g.error(a);null==(i=R.current)||i.reload(!1),g.success(a)}finally{}}})};return c(m,{children:[p(A,{className:"ant-pro-table-scroll",columns:B,actionRef:R,bordered:!0,cardBordered:!0,defaultSize:"small",scroll:{x:"100%",y:"100%"},request:async i=>{const{data:n}=await e(i);return b(n)},columnsState:{persistenceKey:"use-pro-table-key",persistenceType:"localStorage"},options:{reload:!0,density:!0,fullScreen:!0},rowKey:"id",search:{labelWidth:"auto"},pagination:S,dateFormatter:"string",headerTitle:"代码列表",toolBarRender:()=>[p(u,{type:"primary",icon:p(y,{}),onClick:e=>(e=>{var i;null==(i=M.current)||i.showDBTableModal(),setTimeout((()=>e()),1e3)})(e),children:"导入数据库表"},"importTable")]}),p(I,{ref:M,onConfirm:async e=>{var n;let a=[];e.forEach((e=>a.push(e.tableName)));const{msg:t,code:r}=await i(a);r==k.SUCCESS?null==(n=R.current)||n.reload(!1):g.error(t)}}),p(z,{ref:N,onConfirm:()=>{}})]})};export{E as default};

import{g as e,a}from"./index-BA-pgaga.js";import{r as s,e as r,k as t,m as i,ak as n,j as l,M as d,b as o,R as c,C as m,I as u,L as h}from"./index-ISw6CgS3.js";import{a as p,e as y,u as f}from"./index-C3eBkcGt.js";import{T as S}from"./index-h1O26a0J.js";import{R as C}from"./index-4Y5L38_t.js";import{T as k}from"./index-BTaHlN9v.js";import"./iconUtil-DIyXkSWd.js";import"./List-DXhAeaBF.js";const w=s.forwardRef((({onConfirm:w},b)=>{const[g]=r.useForm(),[I,j]=s.useState(!1),[x,E]=s.useState({}),[v,F]=s.useState(new Map),[A,T]=s.useState([]),[U,q]=s.useState({});s.useImperativeHandle(b,(()=>({showAddFormModal(){K(),M(0),j(!0)},async showEditFormModal(e){const{data:a,msg:s,code:r}=await p(e);r===t.SUCCESS?(setTimeout((()=>{T(a.menuIds||[])}),500),E(a),M(e),g.setFieldsValue(a),j(!0)):i.error(s)}})));const M=async e=>{const{data:a}=await n(e);q(a)};s.useEffect((()=>{(async()=>{const{data:s,msg:r,code:n}=await e("admin_sys_status");n===t.SUCCESS?F(a(s)):i.error(r)})()}),[]);const K=()=>{x.id>0?E({}):E({id:0}),T([]),q({}),setTimeout((()=>g.resetFields()),100)};return l(d,{title:x.id>0?"编辑":"新增",getContainer:!1,width:500,open:I,maskClosable:!1,keyboard:!1,onCancel:()=>{K(),j(!1)},destroyOnClose:!0,footer:[l(h,{onClick:async e=>{K(),j(!1),e()},children:"取消"},"cancel"),l(h,{type:"primary",onClick:async e=>{g.validateFields().then((async a=>{try{if(x.id<=0){const{msg:e,code:s}=await y({...a,menuIds:A});if(s!==t.SUCCESS)return void i.error(e);i.success(e)}else{const{msg:e,code:s}=await f(x.id,{...a,menuIds:A});if(s!==t.SUCCESS)return void i.error(e);i.success(e)}K(),j(!1),w()}finally{e()}})).catch((a=>{i.error("表单校验失败"),e()}))},children:"确定"},"confirm")],children:o(r,{form:g,layout:"vertical",initialValues:x,children:[o(c,{gutter:24,children:[l(m,{span:12,children:l(r.Item,{name:"roleName",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:l(u,{placeholder:"请输入角色名称"})})}),l(m,{span:12,children:l(r.Item,{name:"roleKey",label:"角色键",rules:[{required:!0,message:"请输入角色键"}],children:l(u,{placeholder:"请输入角色键"})})}),l(m,{span:12,children:l(r.Item,{name:"roleSort",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:l(S,{placeholder:"请输入排序",style:{width:"100%"},min:0})})}),l(m,{span:12,children:l(r.Item,{name:"status",label:"角色状态",rules:[{required:!0,message:"请输入角色状态"}],children:l(C.Group,{children:Array.from(v).map((([e,a])=>l(C,{value:e,children:a},e)))})})}),l(m,{span:24,children:l(r.Item,{name:"menuOptions",label:"菜单权限",children:l(k,{checkable:!0,checkedKeys:A,onCheck:(e,a)=>{const s=Array.isArray(e)?e:e.checked;T(s)},defaultExpandedKeys:[0],fieldNames:{title:"title",key:"id",children:"children"},treeData:U.menus,style:{width:"100%"}})})})]}),l(r.Item,{name:"remark",label:"备注",children:l(u.TextArea,{placeholder:"请输入备注"})})]})})}));export{w as default};

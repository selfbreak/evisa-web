import{a as e}from"./index-BOSj9b5K.js";import{r as t,e as i,k as a,m as n,j as l,F as s,b as r,I as d,R as o,C as A,G as c,co as h,B as g,S as m,L as E}from"./index-CiAhniVm.js";import{g as Q,e as y,a as p,b as u,c as B,d as C,f as I,h as v}from"./index-CeVyQ8_h.js";import{D as f}from"./index-76LpRGMh.js";import{D as S}from"./index-CTQNLHnJ.js";import{U as b}from"./index-lJVXQZS9.js";import{R as j}from"./index-Bunx-TGd.js";import{S as w}from"./index-BJu6fcxc.js";import{D as k}from"./index-D_cDM7fs.js";import{I as J}from"./index-DYoDAZSL.js";import"./progress-i1-phs3_.js";import"./useShowArrow-DWmC_yFD.js";import"./List-DhKJSDjz.js";import"./useIcons-6XAMJw6F.js";import"./dayjs.min-x_ORfqZN.js";import"./addEventListener-DLPOesXj.js";const N=t.forwardRef((({onConfirm:N},x)=>{const[Y]=i.useForm(),[F,K]=t.useState(!1),[R,U]=t.useState({}),[z,M]=t.useState("single"),[D,T]=t.useState(!1),[H,L]=t.useState(""),[Z,G]=t.useState(""),[P,q]=t.useState(""),[V,_]=t.useState(""),[X,O]=t.useState(""),[W,$]=t.useState(""),[ee,te]=t.useState(""),[ie,ae]=t.useState(""),[ne,le]=t.useState("");t.useImperativeHandle(x,(()=>({showAddFormModal(){se(),K(!0)},async showEditFormModal(e){const{data:t,msg:i,code:l}=await Q(e);l===a.SUCCESS?(U(t),Y.setFieldsValue(t),q(`${t.first_name} ${t.last_name}`),_(t.passport_number||""),K(!0)):n.error(i)}})));const se=()=>{R.id>0?U({}):U({id:0}),setTimeout((()=>Y.resetFields()),100)};return l(s,{children:r(f,{title:R.id>0?"apply":"新增用户",width:1200,open:F,onClose:()=>{se(),K(!1)},bodyStyle:{padding:"10px"},footerStyle:{textAlign:"right"},footer:r(m,{children:[l(E,{onClick:e=>{se(),K(!1),e()},children:"取消"}),l(E,{type:"primary",onClick:t=>(t=>{const i=Y.getFieldsValue(),l=["entry_date","exit_date","visa_type","photo","sign_image"].filter((e=>{const t=i[e];return null==t||""===t}));if(l.length>0)return n.error(`以下字段不能为空：${l.join("、")}`),void t();Y.validateFields().then((async i=>{var l,s;try{const t={...i,entry_date:null==(l=i.entry_date)?void 0:l.format("DD/MM/YYYY"),exit_date:null==(s=i.exit_date)?void 0:s.format("DD/MM/YYYY"),visa_type_text:"417"===i.visa_type||"418"===i.visa_type?"«Один месяц»":"419"===i.visa_type||"420"===i.visa_type?"«Два месяца»":"421"===i.visa_type||"422"===i.visa_type?"«Три месяца»":"«Один месяц»"};if(R.id<=0){const{msg:i,code:l}=await e(t);if(l!==a.SUCCESS)return void n.error(i);n.success(i)}else{const{msg:e,code:i}=await v(R.id,t);if(i!==a.SUCCESS)return void n.error(e);n.success("提交成功，请到列表点击支付按钮")}se(),K(!1),N()}finally{t()}})).catch((e=>{n.error("表单校验失败"),t()}))})(t),children:"确定"})]}),children:[R.id<=0&&r(i,{form:Y,layout:"vertical",initialValues:R,children:[l(i.Item,{name:"mobileTitle",label:"国家区号",children:l(d,{placeholder:"请输入国家区号"})}),l(i.Item,{name:"mobiles",label:"手机号码集合",children:l(d.TextArea,{placeholder:"请输入手机号(多个手机号之间使用半角逗号分割)"})}),l(i.Item,{name:"emails",label:"邮箱集合",children:l(d.TextArea,{placeholder:"请输入邮箱(多个邮箱之间使用半角逗号分割)"})}),l(i.Item,{name:"refCode",label:"邀请码",children:l(d,{placeholder:"请输入邀请码"})})]}),R.id>0&&l(i,{form:Y,layout:"vertical",initialValues:R,autoComplete:"off",children:r(o,{children:[r(A,{span:12,children:[l(S,{children:"用户信息"}),r(o,{gutter:16,children:[l(A,{span:12,children:r(o,{gutter:14,children:[l(A,{span:4,children:"姓名"}),l(A,{span:10,children:P})]})}),l(A,{span:12,children:r(o,{gutter:12,children:[l(A,{span:5,children:"护照号"}),l(A,{span:8,children:V})]})})]}),l(S,{children:"基本信息"}),r(o,{gutter:16,children:[r(A,{span:12,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"邮箱地址"}),l(c,{title:"刷新邮箱地址",children:l(h,{onClick:async()=>{const e=await(async()=>await u())();200===e.code?(O(e.data.email||""),Y.setFieldsValue({email:e.data.email}),n.success("邮箱已更新")):n.error("刷新邮箱失败")},style:{cursor:"pointer",fontSize:16}})})]}),l(i.Item,{name:"email",style:{marginBottom:16},children:l(d,{placeholder:"请输入邮箱地址",value:X,onChange:e=>O(e.target.value)})})]}),r(A,{span:12,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"手机号码"}),l(c,{title:"刷新手机号码",children:l(h,{onClick:async()=>{const e=await(async()=>await B())();200===e.code?($(e.data),Y.setFieldsValue({mobile:e.data}),n.success("邮箱已更新")):n.error("刷新邮箱失败")},style:{cursor:"pointer",fontSize:16}})})]}),l(i.Item,{name:"mobile",style:{marginBottom:16},children:l(d,{placeholder:"请输入手机号码"})})]})]}),r(o,{gutter:[16,16],children:[r(A,{span:24,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"中国地址"}),l(c,{title:"Refresh China Address",children:l(h,{onClick:async()=>{const e=await(async()=>await C())();200===e.code?(te(e.data),Y.setFieldsValue({china_address:e.data}),n.success("The address has been updated.")):n.error("Failed to refresh the address.")},style:{cursor:"pointer",fontSize:16}})})]}),l(i.Item,{name:"china_address",style:{marginBottom:16},children:l(d.TextArea,{placeholder:"请输入中国地址",value:W,onChange:e=>$(e.target.value),autoSize:{minRows:2}})})]}),r(A,{span:24,children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l("label",{style:{marginBottom:8},children:"吉尔吉斯地址"}),l(c,{title:"Refresh Kyrgyz Address",children:l(h,{onClick:async()=>{const e=await(async()=>await I())();200===e.code?(ae(e.data),Y.setFieldsValue({kg_address:e.data}),n.success("The address has been updated.")):n.error("Failed to refresh the address.")},style:{cursor:"pointer",fontSize:16}})})]}),l(i.Item,{name:"kg_address",children:l(d.TextArea,{placeholder:"请输入吉尔吉斯地址",value:ie,onChange:e=>ae(e.target.value),autoSize:{minRows:2}})})]})]}),l(S,{children:"上传2寸照片信息"}),r(i.Item,{name:"photo",children:[l(d,{type:"hidden"}),l(b,{name:"file",listType:"picture-card",showUploadList:!1,customRequest:async({file:e,onSuccess:t,onError:i})=>{T(!0);try{const a=e;await y({file:a,onSuccess:e=>{400===e.code?(n.error(`${a.name} 上传失败: ${e.msg}`),null==i||i(new Error(e.msg))):(n.success(`${a.name} 上传成功`),Y.setFieldsValue({photo:e.data}),le("https://visa.koko.kg/"+e.data),null==t||t("ok"))},onError:e=>{n.error(`${a.name} 上传失败: ${e.message}`),null==i||i(e)}})}catch(a){n.error("上传过程发生异常"),null==i||i(a)}finally{T(!1)}},children:ne?r("div",{style:{textAlign:"center"},children:[l("div",{style:{width:"100%",paddingTop:"100%",position:"relative",overflow:"hidden"},children:l("img",{src:ne,alt:"uploaded",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",cursor:"pointer"},onClick:()=>window.open(ne,"_blank")})}),l("div",{style:{marginTop:8,textAlign:"center",color:"#1677ff"},children:l("span",{children:"重新上传"})})]}):l("div",{style:{textAlign:"center",color:"#999",background:"none"},children:"点击上传"})})]})]}),r(A,{span:12,style:{paddingLeft:20},children:[l(S,{children:"签证信息"}),r(o,{gutter:16,children:[r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"办理速度"})}),l(i.Item,{name:"service_level",children:r(j.Group,{children:[l(j.Button,{value:"1",children:"普通"}),l(j.Button,{value:"2",children:"加急"})]})})]}),r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"入境次数"})}),l(i.Item,{name:"entry_type",children:r(j.Group,{onChange:e=>{M(e.target.value),Y.setFieldsValue({visa_type:""})},children:[l(j.Button,{value:"1",children:"单次"}),l(j.Button,{value:"3",children:"多次"})]})})]}),r(A,{span:8,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"签证类别"})}),l(i.Item,{name:"visa_type",children:r(w,{children:[l(w.Option,{value:"",children:"请选择"}),r(s,"1"===z?{children:[l(w.Option,{value:"417",children:"单次1个月"}),l(w.Option,{value:"419",children:"单次2个月"}),l(w.Option,{value:"421",children:"单次3个月"})]}:{children:[l(w.Option,{value:"418",children:"多次1个月"}),l(w.Option,{value:"420",children:"多次2个月"}),l(w.Option,{value:"422",children:"多次3个月"})]})]})})]})]}),r(o,{gutter:16,children:[r(A,{span:12,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"入境日期"})}),l(i.Item,{name:"entry_date",children:l(k,{format:"DD/MM/YYYY"})})]}),r(A,{span:12,children:[l("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:l("label",{style:{marginBottom:8},children:"出境日期"})}),l(i.Item,{name:"exit_date",children:l(k,{format:"DD/MM/YYYY"})})]})]}),l(S,{children:"申请函件"}),l(i.Item,{name:"sign_image",children:l(d,{type:"hidden"})}),l(J,{width:200,height:200,src:Z,fallback:"data:image/png;base64,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"}),l("div",{style:{marginTop:"10px"},children:l(g,{type:"primary",onClick:async()=>{const e=Y.getFieldValue("visa_type"),t="417"===e||"418"===e?"«Один месяц»":"419"===e||"420"===e?"«Два месяца»":"421"===e||"422"===e?"«Три месяца»":"«Один месяц»",i=await p(R.id??0,{address:Y.getFieldsValue().china_address,phone:Y.getFieldsValue().mobile,duration:t});200===i.code?(G("https://visa.koko.kg/"+i.data),L(i.data),Y.setFieldsValue({sign_image:i.data}),n.success("生成成功")):n.error("生成失败")},children:H.length>0?"重新申请函件":"申请函件"})})]})]})})]})})}));export{N as default};

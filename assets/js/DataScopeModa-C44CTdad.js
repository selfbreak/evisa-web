import{r as e}from"./index-8L4V_yxL.js";import{g as a,a as s}from"./index-Cc57wi3Z.js";import{a as t,b as r}from"./index-CsmvDA_R.js";import{r as i,e as o,k as d,m as n,j as l,M as c,b as m,R as p,C as h,I as u,L as S}from"./index-CiAhniVm.js";import{S as f}from"./index-BJu6fcxc.js";import{T as y}from"./index-Cv3fXZDU.js";import"./useShowArrow-DWmC_yFD.js";import"./List-DhKJSDjz.js";import"./useIcons-6XAMJw6F.js";import"./iconUtil--IrZyQfQ.js";const C=i.forwardRef((({onConfirm:C},b)=>{const[j]=o.useForm(),[w,g]=i.useState(!1),[k,I]=i.useState({}),[x,v]=i.useState(new Map),[E,A]=i.useState([]),[F,U]=i.useState({}),[T,_]=i.useState("");i.useImperativeHandle(b,(()=>({async showDataScopeFormModal(a){const{data:s,msg:r,code:i}=await t(a);if(i!==d.SUCCESS)return void n.error(r);const{data:o,msg:l,code:c}=await e(a);c===d.SUCCESS?(setTimeout((()=>{A(s.deptIds||[])}),500),setTimeout((()=>{U(o)}),500),I(s),_(s.dataScope),j.setFieldsValue(s),g(!0)):n.error(l)}})));i.useEffect((()=>{(async()=>{const{data:e,msg:t,code:r}=await a("admin_sys_role_data_scope");r===d.SUCCESS?v(s(e)):n.error(t)})()}),[]);const M=()=>{k.id>0?I({}):I({id:0}),A([]),U({}),setTimeout((()=>j.resetFields()),100)};return l(c,{title:"数据权限",getContainer:!1,width:500,open:w,maskClosable:!1,keyboard:!1,onCancel:()=>{M(),g(!1)},destroyOnClose:!0,footer:[l(S,{onClick:async e=>{M(),g(!1),e()},children:"取消"},"cancel"),l(S,{type:"primary",onClick:async e=>{j.validateFields().then((async a=>{try{let e=E;"2"!==T&&(e=[]);const{msg:s,code:t}=await r({...a,id:k.id,deptIds:e});if(t!==d.SUCCESS)return void n.error(s);n.success(s),M(),g(!1),C()}finally{e()}})).catch((a=>{n.error("表单校验失败"),e()}))},children:"确定"},"confirm")],children:l(o,{form:j,layout:"vertical",onValuesChange:(e,a)=>{_(a.dataScope)},initialValues:k,children:m(p,{gutter:24,children:[l(h,{span:12,children:l(o.Item,{name:"roleName",label:"角色名称",children:l(u,{disabled:!0})})}),l(h,{span:12,children:l(o.Item,{name:"roleKey",label:"角色键",children:l(u,{disabled:!0})})}),l(h,{span:24,children:l(o.Item,{name:"dataScope",label:"数据范围",rules:[{required:!0,message:"请输入数据范围"}],children:l(f,{placeholder:"请选择",children:Array.from(x).map((([e,a])=>l(f.Option,{value:e,children:a},e)))})})}),"2"==T&&l(h,{span:24,children:l(o.Item,{name:"deptOptions",label:"权限范围",children:l(y,{checkable:!0,defaultExpandAll:!0,checkedKeys:E,onCheck:(e,a)=>{const s=Array.isArray(e)?e:e.checked;A(s)},fieldNames:{title:"deptName",key:"id",children:"children"},treeData:F.depts,style:{width:"100%"}})})})]})})})}));export{C as default};
